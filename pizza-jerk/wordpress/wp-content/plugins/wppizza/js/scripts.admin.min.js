jQuery(document).ready(function(e){if("edit-wppizza_menu"==pagenow){var t=e("#the-list");t.sortable({update:function(e,a){jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"cat_sort",order:t.sortable("toArray").toString()}},function(e){},"json").error(function(e,t,a){alert("error : "+a)})}})}wpPizzaCreateNewKey=function(t,a){"undefined"!=typeof a&&a.hide();for(var i=e("#"+t+" .wppizza-getkey"),p=i.get(),r=[],o=0;o<p.length;o++)r.push(e(p[o]).attr("id").split("_").pop(-1));var n=Math.max.apply(null,r);if(0>n)var s=0;else var s=n+1;return s},e("#wppizza-settings,.wppizza-settings").on("click",".wppizza-time-select",function(t){t.preventDefault(),e(this).timepicker({hourText:"Hour",minuteText:"Min",amPmText:["",""],hours:{starts:0,ends:23},minutes:{starts:0,ends:45,interval:15}}).timepicker("show")}),e("#wppizza-settings,.wppizza-settings").on("click",".wppizza-date-select",function(t){t.preventDefault(),e(this).datepicker({dateFormat:"dd M yy"}).datepicker("show")}),e(document).on("click","#wppizza_reports_start_date,#wppizza_reports_end_date",function(t){t.preventDefault(),e(this).datepicker({dateFormat:"yy-mm-dd"}).datepicker("show")}),e(document).on("click","#wppizza-report-top10-volume>h3",function(t){e("#wppizza-report-top10-volume-ul").toggle(),e("#wppizza-report-bottom10-volume-ul").toggle()}),e(document).on("click","#wppizza-report-top10-value>h3",function(t){e("#wppizza-report-top10-value-ul").toggle(),e("#wppizza-report-bottom10-value-ul").toggle()}),e(document).on("change","#wppizza-reports-set-range",function(t){var a=e(this),i=a.val(),p=window.location.href.split("?")[0],r=p+"?post_type=wppizza&page=wppizza-reports";""!=i&&(r+="&report="+i),window.location.href=r}),e(document).on("click","#wppizza_reports_custom_range",function(t){var a=window.location.href.split("?")[0],i=a+"?post_type=wppizza&page=wppizza-reports",p=e("#wppizza_reports_start_date").val(),r=e("#wppizza_reports_end_date").val();""!=p&&""!=r&&(i+="&from="+p,i+="&to="+r),window.location.href=i}),e(document).on("click","#wppizza_reports_export",function(t){var a=window.location.href.split("?")[0],i=a+"?post_type=wppizza&page=wppizza-reports",p=e("#wppizza_reports_start_date").val(),r=e("#wppizza_reports_end_date").val(),o=e("#wppizza-reports-set-range :selected").text(),n=e("#wppizza-reports-set-range").val(),s=!1;""!=p&&""!=r&&(s=!0,i+="&from="+p,i+="&to="+r),s||(i+="&name="+encodeURIComponent(o),i+="&report="+encodeURIComponent(n)),i+="&export=true",window.location.href=i}),e(document).on("click","#wppizza_add_opening_times_custom",function(t){t.preventDefault(),jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"opening_times_custom"}},function(t){e("#wppizza_opening_times_custom_options").append(t)},"html").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click","#wppizza_add_times_closed_standard",function(t){t.preventDefault(),jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"times_closed_standard"}},function(t){e("#wppizza_times_closed_standard_options").append(t)},"html").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click","#wppizza_add_sizes",function(t){t.preventDefault();var a=e(this),i=wpPizzaCreateNewKey("wppizza_sizes_options",a),p=parseInt(e("#wppizza_add_sizes_fields").val());p>=1&&jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"sizes",id:i,newFields:p}},function(t){var i=t;e("#wppizza_sizes_options").append(i),a.show()},"html").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click","#wppizza_add_additives",function(t){t.preventDefault();var a=e(this),i=wpPizzaCreateNewKey("wppizza_additives_options",a);jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"additives",id:i}},function(t){e("#wppizza_additives_options").append(t),a.show()},"html").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click","#wppizza_add_meals",function(t){t.preventDefault();var a=e(this),i=wpPizzaCreateNewKey("wppizza_meals .wppizza_meals_category",a);jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"meals",id:i}},function(t){var p='<span class="wppizza_option">';p+=t,p+='<div id="wppizza_category_items_'+i+'" class="wppizza_category_items"></div>',p+="</span>",e("#wppizza_meals_options").append(p),a.show()},"html").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click",".wppizza_add_meals_item",function(t){t.preventDefault();var a=e(this),a=e(this),i=a.attr("id").split("_").pop(-1),p=wpPizzaCreateNewKey("wppizza_category_items_"+i,a);jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"meals",item:1,id:i,newKey:p}},function(t){e("#wppizza_category_items_"+i).prepend(t),a.show()},"html").error(function(e,t,a){alert("error : "+a)})}),e(document).on("change",".wppizza_pricetier_select",function(t){var a=e(this),i=a.val(),p=a.attr("name").replace("[sizes]",""),r=a.attr("class").split(" ").pop(-1),o=0;a.hasClass("wppizza_pricetier_select_meta")&&(o=1),jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"sizeschanged",id:i,inpname:p,classId:r,metabox:o}},function(t){e.each(t.element,function(e,i){"undefined"!=typeof t.inp[e]&&(findElementById=a.closest("#wppizza").find(i),findElementById.length>0?a.closest("#wppizza").find(i).empty().html(t.inp[e]):a.closest(".wppizza_option").find(".wppizza_pricetiers").empty().html(t.inp[e]))})},"json").error(function(e,t,a){alert("error : "+a)})}),e(document).on("change",".wppizza_order_form_type",function(t){var a=e(this),i=(a.attr("id").split("_").pop(-1),a.val());a.closest("td").find(".wppizza_order_form_select input").val(""),"select"==i?a.closest("td").find(".wppizza_order_form_select").css("display","block"):a.closest("td").find(".wppizza_order_form_select").css("display","none")}),e(document).on("change","#wppizza_layout_style",function(t){var a=e(this).val();"grid"==a?e("#wppizza-style-grid").css("display","block"):e("#wppizza-style-grid").css("display","none")}),e(document).on("click",".wppizza-delete",function(t){t.preventDefault();var a=e(this);if(a.hasClass("sizes")){var i=e("#wppizza_sizes_options>span").length;if(1>=i)return void alert("Sorry, at least one size option must be defined")}var p=e(this).closest(".wppizza-row-remove");p.length>0?p.remove():e(this).closest("span").remove()}),e(document).on("click",".wppizza-gateway-show-options",function(t){var a=e(this);e(".wppizza-gateway-settings").slideUp(),a.closest(".wppizza-gateway").find(".wppizza-gateway-settings").slideDown()}),e(document).on("click","#wppizza-toggle-tgs",function(t){e("#wppizza_order_form tr.ctips,#wppizza_order_form tr.csurcharges").toggle("slow")}),e(document).on("click","#wppizza_show_php_vars",function(t){var a=e("#wppizza_php_info");jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"get-php-vars"}},function(e){a.html(e)},"html").error(function(e,t,a){alert("error : "+a)})}),e(".wppizza_delivery_calculation_exclude_item, .wppizza_delivery_calculation_exclude_cat, .wppizza_discount_calculation_exclude_item, .wppizza_discount_calculation_exclude_cat").chosen({inherit_select_classes:!0,width:"95%"}),e(document).on("click",".wppizza-print-order",function(t){t.preventDefault();var a=e(this).attr("id").split("-").pop(-1),i=e("#wppizza_order_id_"+a).val(),p="",r=e("#wppizza_order_blogid_"+a);r.length>0&&(p=r.val()),jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"print-order",id:i,blogid:p}},function(e){var t=window.open("","WppizzaOrder","width=750,height=550");if(null==t||"undefined"==typeof t)return void alert("You must turn off your pop-up blocker to enable printing.\n\nPlease consult your device manufacturer about how to turn off pop-up blocking for this site.\n\n");if(t.document.open("text/html","replace"),"text/plain"==e["content-type"]){var a=e.plaintext;t.document.write("<pre>"+a+"</pre>")}else{var a=e.html;t.document.write(a)}t.focus(),t.print()},"json").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click touchstart",".wppizza-print-order-prev",function(t){t.preventDefault();var i=e(this).attr("id").split("-").pop(-1),p=e("#wppizza_order_initiator_"+i).val(),r=e("#wppizza_order_transaction_id_"+i).val(),o=e("#wppizza_order_details-"+i).html(),n=e("#wppizza_order_customer_details-"+i).html(),s=e("#wppizza-order-notes-"+i).val(),l=(document.body.innerHTML,"<html><head><title></title></head><body>"+p+"<br />"+r+"<br /><br />"+n+"<br />"+o+"<br /><br />"+a(s)+"</body></html>"),d=window.open("","WppizzaOrder","width=750,height=550");d.document.write(l),d.focus(),d.print()});var a=function(e,t){var a=t||"undefined"==typeof t?"<br />":"<br>",i=(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+a+"$2");return i=i.replace(/\s{2}/g,"&nbsp;&nbsp;")},i=e("#history_orders_poll_enabled");if(i.length>0)var p=e("#history_orders_poll_interval").val(),r=setInterval(function(){o()},1e3*p);e(document).on("change","#history_orders_poll_interval",function(t){var a=e(this).val();clearInterval(r),r=setInterval(function(){o()},1e3*a)});var o=function(){if(e("#history_orders_poll_enabled").is(":checked")){e("#wppizza-orders-polling").addClass("wppizza-load");var t=e("#history_get_orders");t.trigger("click")}};e(document).on("change",".wppizza_order_status",function(t){var a=e(this),i=a.attr("id").split("-").pop(-1),p=e("#wppizza_order_id_"+i).val(),r=a.val(),o=e("#wppizza_order_initiator_ident_"+i).val(),n=r.toLowerCase(),s="",l=e("#wppizza_order_blogid_"+i);l.length>0&&(s=l.val()),e("#wppizza_order_status_popup-"+i).val(r),jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"orderstatuschange",id:p,blogid:s,selVal:r,initiator:o}},function(t){a.closest("tr").removeClass().addClass("wppizza-ord-status-"+n),e("#wppizza_order_update-"+i).html(t)},"html").error(function(e,t,a){alert("error : "+a)})}),e(document).on("change",".wppizza_order_status_popup",function(t){var a=e(this),i=a.attr("id").split("-").pop(-1),p=a.val();e("#wppizza_order_status-"+i).val(""+p),e("#wppizza_order_status-"+i).trigger("change")}),e(document).on("click",".wppizza_order_delete",function(t){if(t.preventDefault(),!confirm("are you sure ?"))return!1;var a=e(this),i=a.attr("id").split("-").pop(-1),p=e("#wppizza_order_id_"+i).val(),r="",o=e("#wppizza_order_blogid_"+i);o.length>0&&(r=o.val()),jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"delete_order",ordId:p,blogid:r}},function(t){alert(t),a.closest("tr").empty().remove(),e("#wppizza-order-failed-"+i).empty().remove(),e("#wppizza-order-notes-tr-"+i).empty().remove(),e("#wppizza-order-has-notes-tr-"+i).empty().remove()},"html").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click",".wppizza-order-add-notes",function(t){var a=e(this),i=a.attr("id").split("-").pop(-1);e("#wppizza-order-notes-tr-"+i+",#wppizza-order-has-notes-tr-"+i).fadeIn("slow")}),e(document).on("click",".wppizza-order-do-notes",function(t){var a=e(this),i=a.attr("id").split("-").pop(-1),p=e("#wppizza_order_id_"+i).val(),r="",o=e("#wppizza_order_blogid_"+i);o.length>0&&(r=o.val());var n=e("#wppizza-order-notes-"+i).val();jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"ordernoteschange",id:p,blogid:r,selVal:n}},function(t){0>=t?(a.closest("tr").fadeOut(250),e("#wppizza-order-add-notes-"+i).fadeIn(250,function(){alert("ok")})):e("#wppizza-order-add-notes-"+i).fadeOut(250,function(){alert("ok")})},"text").error(function(e,t,a){alert("error : "+a)})});var n=0;e(document).on("click","#history_get_orders",function(t){t.preventDefault();var a=e("#history_orders_limit").val(),i=e("#history_orders_status").val(),p=e("#wppizza_history_search").find("[name]").serialize();jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"get_orders",limit:a,orderstatus:i,form_fields:p}},function(t){e("#wppizza_history_orders").html(t.orders),e("#wppizza_history_totals").html(t.totals),e("#wppizza-orders-polling").removeClass(),n=0},"json").error(function(e,t,a){n++,n>=5?alert("error : "+a):console.log("error : "+a)})});var s=e("#history_get_orders");s.trigger("click"),e(document).on("click","#wppizza_history_totals_getall",function(t){t.preventDefault(),jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"get_orders_total"}},function(t){e("#wppizza_history_totals").html(t.totals)},"json").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click","#wppizza_order_abandoned_delete",function(t){if(t.preventDefault(),!confirm("are you sure ?"))return!1;var a=e("#wppizza_order_days_delete").val(),i=e("#wppizza_order_failed_delete").is(":checked");jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"delete_abandoned_orders",days:a,failed:i}},function(e){alert(e)},"html").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click",".wppizza-order-failed-toggle-details",function(t){var a=e(this),i=a.attr("id").split("-").pop(-1);e("#wppizza-order-failed-details-"+i).toggle()}),e(document).on("click",".wppizza_order_customer_details,.wppizza_order_details",function(t){var a=e(this),i=(a.closest("tr"),a.attr("id").split("-").pop(-1)),p=e("#wppizza_order_transaction_id_"+i).val()+" | "+e("#wppizza_order_date_"+i).val(),r="wppizza_order_popup_"+i,o=e("#wppizza_order_status_popup-"+i).val(),n="ACKNOWLEDGED";return o!=n&&"NEW"==o&&(e("#wppizza_order_status_popup-"+i).val(""+n),e("#wppizza_order_status-"+i).val(""+n),e("#wppizza_order_status-"+i).trigger("change")),tb_show(""+p,"#TB_inline?width=580&height=520&inlineId="+r),!1});var l=function(){var t=e(".wppizza-template-parts");"undefined"!=typeof t&&t.sortable({handle:".wppizza-template-sort-part",axis:"x",delay:150,distance:10,update:function(e,t){z(e,t)}})};l();var d=function(){var t=e(".wppizza-template-sort-vars");"undefined"!=typeof t&&t.sortable({handle:".wppizza-template-sort-var",axis:"y",delay:150,distance:10,cancel:".wppizza-template-sort-vars-addinfo",update:function(e,t){z(e,t)}})};d();var z=function(t,a){var i=a.item,p=i.closest("tbody").find(".wppizza-values-order"),r="",o={};e.each(p,function(t,a){var i=e(a).attr("id"),p=i.split("."),n=p[2],s=p[3];r=""+p[1],"undefined"==typeof o[n]&&(o[n]={}),"undefined"==typeof o[n][s]&&(o[n][s]=1)});var n=JSON.stringify(o);e("#wppizza-sortorder-"+r).val(n)};e(document).on("change",".wppizza_template_mail_type",function(t){var a=e(this),i=a.val(),p=a.attr("id").split("_"),r=p.pop(-1),o=p.pop(-3);e("#wppizza-template-body-"+r+", #wppizza-template-global-styles-"+r).fadeOut(250),"phpmailer"==i&&e("#wppizza-dashicons-template-"+o+"-media-code-"+r).removeClass("wppizza-dashicons-template-"+o+"-media-code-inactive").addClass("wppizza_template_style_toggle wppizza-dashicons-template-"+o+"-media-code"),"wp_mail"==i&&e("#wppizza-dashicons-template-"+o+"-media-code-"+r).removeClass("wppizza-dashicons-template-"+o+"-media-code wppizza_template_style_toggle").addClass("wppizza-dashicons-template-"+o+"-media-code-inactive")});var c="";e(document).on("click",".wppizza_template_details_toggle",function(t){var a=e(this),i=a.attr("id").split("_"),p=i.pop(-1),r=i.pop(-2),o=e("#wppizza-template-body-"+p),n=e("#wppizza-template-global-styles-"+p),s=e(".wppizza-template-"+r+"-value-element-"+p),l=e(".wppizza-template-"+r+"-style-element-"+p),d=e(".wppizza-template-"+r+"-value-element-only-"+p);(o.is(":visible")||n.is(":visible"))&&"details"==c?(n.hide(),o.fadeOut()):(n.hide(),l.hide(),o.fadeIn(),s.fadeIn(),d.fadeIn()),c="details"}),e(document).on("click",".wppizza_template_style_toggle",function(t){var a=e(this),i=a.attr("id").split("-"),p=i[i.length-1],r=i[i.length-4],o=e("#wppizza-template-body-"+p),n=e("#wppizza-template-global-styles-"+p),s=e(".wppizza-template-"+r+"-value-element-"+p),l=e(".wppizza-template-"+r+"-style-element-"+p),d=e(".wppizza-template-"+r+"-value-element-only-"+p);(o.is(":visible")||n.is(":visible"))&&"style"==c?(n.fadeOut(),o.fadeOut()):(s.hide(),d.hide(),"print"!=r&&o.fadeIn(),n.fadeIn(),l.fadeIn()),c="style"}),e(document).on("click",".wppizza_add_templates",function(t){t.preventDefault();var a=e(this),i=a.attr("id").split("_").pop(-1);a.attr("disabled","true");var p=e(".wppizza-template-new").length;jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"add_template",arrayKey:i,countNewKeys:p}},function(t){e("#wppizza_list_templates").prepend(t.markup),a.removeAttr("disabled"),l(),d()},"json").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click",".wppizza_template_delete",function(t){var a=e(this),i=a.attr("id").split("-").pop(-1),p=a.attr("id").split("_")[2],r=e("#wppizza-template-table-"+i);r.empty().remove(),"print"==p&&e("#wppizza_templates_print_print_id_"+i+":checked")&&e("#wppizza_templates_print_print_id_default").prop("checked",!0),"emails"==p&&(e("#wppizza_templates_emails_recipients_email_customer_"+i+":checked")&&e("#wppizza_templates_emails_recipients_default_email_customer").prop("checked",!0),e("#wwppizza_templates_emails_recipients_email_shop_"+i+":checked")&&e("#wppizza_templates_emails_recipients_default_email_shop").prop("checked",!0)),r.hasClass("wppizza-template-new")||e("#wppizza_list_templates").append('<input type="hidden" name="wppizza[template_remove]['+p+"]["+i+']" value="'+i+'" />')}),e(document).on("focus blur",".wppizza-template-global-style,.wppizza-template-section-style,.wppizza-template-parts-style",function(t){var a=e(this),i=t.type;a.hasClass("wppizza-template-print-global-style-body")?("focusin"==i&&e(this).animate({height:250},200),"focusout"==i&&e(this).animate({height:50},200)):("focusin"==i&&e(this).animate({height:100},200),"focusout"==i&&e(this).animate({height:25},200))}),e(document).on("click",".wppizza_template_preview",function(t){var a=e(this),i=a.attr("id").split("-").pop(-1),p={};p.tplId=i,p.tplType=a.attr("id").split("_")[2];var r=p.tplType;p.mail_type=e("#wppizza_template_mail_type_"+r+"_"+i).val();var o="text";"phpmailer"==p.mail_type&&(o="html");var n=e("#wppizza-template-body-"+i+' :input[type="checkbox"]:checked, #wppizza-template-body-'+i+" textarea, #wppizza-template-global-styles-"+i+" textarea");p.templateElms=e.param(n),jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"preview_template",data:p}},function(e){var t,a=600,i=600,p=screen.width?(screen.width-a)/2:0,r=screen.height?(screen.height-i)/2:0,o="height="+i+",width="+a+",top="+r+",left="+p;t="text/html"==e["content-type"]?e.html:'<textarea style="position:absolute;top:0;right:0;left:0;bottom:0;width:100%;min-width:600px">'+e.plaintext+"</textarea>";var n=window.open("","WpPizzaPreviewWindow",o);"text/html"==e["content-type"]?n.document.open("text/html","replace"):n.document.open("text/plain","replace"),n.document.write(t),n.focus()},"json").error(function(e,t,a){alert("error : "+a)})}),e(document).on("click",".wppizza-template-part",function(t){var a=e(this),i=a.attr("id").split("-"),p=i[3],r=i[4],o=e(".wppizza-template-input-var-"+p+"-"+r+" input");a.is(":checked")?o.prop("checked",!0):o.prop("checked",!1)}),e(document).on("click",".wppizza-template-input-var input",function(t){var a=e(this),i=e(this).closest("span").attr("id").split("-"),p=i[4],r=i[5],o=e("#wppizza-template-part-"+p+"-"+r),n=a.closest(".wppizza-template-sort-vars").find("input[type=checkbox]"),s=0;e.each(n,function(t,a){e(this).is(":checked")&&s++}),0==s?o.prop("checked",!1):o.prop("checked",!0)}),e(document).on("click","#wppizza_smtp_test",function(t){t.preventDefault();e(this).closest("form").serialize();e("#wppizza_smtp_test_results").fadeIn(),e("#wppizza_smtp_test_results>pre").text("---one moment : testing smtp connection---");var a={};return a.smtp_email=e("#wppizza_smtp_test_email").val(),a.smtp_host=e("#wppizza_smtp_host").val(),a.smtp_port=e("#wppizza_smtp_port").val(),e("#wppizza_smtp_authentication").is(":checked")&&(a.smtp_authentication=1),a.smtp_encryption=e("#wppizza_smtp_encryption").val(),a.smtp_username=e("#wppizza_smtp_username").val(),a.smtp_password=e("#wppizza_smtp_password").val(),""==a.smtp_email?(e("#wppizza_smtp_test_results").hide(),void alert("please enter an email address")):void jQuery.post(ajaxurl,{action:"wppizza_admin_json",vars:{field:"wppizza_smtp_test",wppizza_smtp_test_param:a}},function(t){e("#wppizza_smtp_test_results>pre").html(t)},"html").error(function(e,t,a){alert("error : "+a)})})});